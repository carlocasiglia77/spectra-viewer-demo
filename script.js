// ... truncated for brevity, but should include full script in final
